<link href="../static/css/validation/formValidation.css">
<link rel="stylesheet" href="../static/css/fileinput.css">
<script src="../static/js/validation/formValidation.js"></script>
<script src="../static/js/validation/bootstrap.js"></script>
<script src="../static/js/validation/zh_CN.js"></script>
<script src="../static/js/fileinput.js"></script>
<script src="../static/js/fileinput_locale_zh.js"></script>
<script src="//cdn.bootcss.com/jquery.form/3.51/jquery.form.js"></script>
<style type="text/css">
    .form-horizontal .has-feedback .form-control-feedback {
        top: 0;
        right: -30px;
    }
    @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 400;
        src: local('Open Sans'), local('OpenSans'), url(http://fonts.gstatic.com/s/opensans/v13/cJZKeOuBrn4kERxqtaUH3T8E0i7KZn-EPnyo3HZu7kw.woff) format('woff');
    }

    /* cyrillic-ext */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/ek4gzZ-GeXAPcSbHtCeQI_esZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
        unicode-range: U+0460-052F, U+20B4, U+2DE0-2DFF, U+A640-A69F;
    }

    /* cyrillic */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/mErvLBYg_cXG3rLvUsKT_fesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
        unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* greek-ext */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/-2n2p-_Y08sg57CNWQfKNvesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
        unicode-range: U+1F00-1FFF;
    }

    /* greek */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/u0TOpm082MNkS5K0Q4rhqvesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
        unicode-range: U+0370-03FF;
    }

    /* vietnamese */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/NdF9MtnOpLzo-noMoG0miPesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
        unicode-range: U+0102-0103, U+1EA0-1EF1, U+20AB;
    }

    /* latin-ext */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/Fcx7Wwv8OzT71A3E1XOAjvesZW2xOQ-xsNqO47m55DA.woff2) format('woff2');
        unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        src: local('Roboto'), local('Roboto-Regular'), url(http://fontstatic.useso.com/s/roboto/v15/CWB0XYA8bzo0kSThX0UTuA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
    }

    /* cyrillic-ext */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/77FXFjRbGzN4aCrSFhlh3hJtnKITppOI_IvcXXDNrsc.woff2) format('woff2');
        unicode-range: U+0460-052F, U+20B4, U+2DE0-2DFF, U+A640-A69F;
    }

    /* cyrillic */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/isZ-wbCXNKAbnjo6_TwHThJtnKITppOI_IvcXXDNrsc.woff2) format('woff2');
        unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* greek-ext */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/UX6i4JxQDm3fVTc1CPuwqhJtnKITppOI_IvcXXDNrsc.woff2) format('woff2');
        unicode-range: U+1F00-1FFF;
    }

    /* greek */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/jSN2CGVDbcVyCnfJfjSdfBJtnKITppOI_IvcXXDNrsc.woff2) format('woff2');
        unicode-range: U+0370-03FF;
    }

    /* vietnamese */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/PwZc-YbIL414wB9rB1IAPRJtnKITppOI_IvcXXDNrsc.woff2) format('woff2');
        unicode-range: U+0102-0103, U+1EA0-1EF1, U+20AB;
    }

    /* latin-ext */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/97uahxiqZRoncBaCEI3aWxJtnKITppOI_IvcXXDNrsc.woff2) format('woff2');
        unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 700;
        src: local('Roboto Bold'), local('Roboto-Bold'), url(http://fontstatic.useso.com/s/roboto/v15/d-6IYplOFocCacKzxwXSOFtXRa8TVwTICgirnJhmVJw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
    }

    .div_fl_3 {
        width: 100%;
        height: 150px;
        float: left;
        margin-top: 10px;
        color: #f00;
        border: 1px solid #ccc;
        overflow: hidden;
    }

    *, *:before, *:after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html, body {
        height: 100%;
    }

    ul {
        list-style: none;
    }

    .cf:before, .cf:after {
        content: '';
        display: table;
    }

    .cf:after {
        clear: both;
    }

    .title {
        padding: 50px 0;
        font: 24px 'Open Sans', sans-serif;
        text-align: center;
    }

    .inners {
        max-width: 820px;
        margin: 0 auto;

    }

    .breadcrumbs {
        font: 12px/1 'Roboto', sans-serif;
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        background-color: #f5f5f5;
    }

    .breadcrumbs ul {
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
        margin-bottom: 0;
    }

    .breadcrumbs li {
        float: left;
        width: 33.3%;
    }

    .breadcrumbs a {
        position: relative;
        display: block;
        padding: 20px;
        padding-right: 0 !important;
        /* important overrides media queries */
        font-size: 13px;
        font-weight: bold;
        text-align: center;
        color: #aaa;
        cursor: pointer;
    }

    .breadcrumbs a:hover {
        background: #eee;
    }

    .breadcrumbs a.active {
        color: #777;
        background-color: #fafafa;
    }

    .breadcrumbs a span:first-child {
        display: inline-block;
        width: 22px;
        height: 22px;
        padding: 2px;
        margin-right: 5px;
        border: 2px solid #aaa;
        border-radius: 50%;
        background-color: #fff;
    }

    .breadcrumbs a.active span:first-child {
        color: #fff;
        border-color: #777;
        background-color: #777;
    }

    .breadcrumbs a:before,
    .breadcrumbs a:after {
        content: '';
        position: absolute;
        top: 0;
        left: 100%;
        z-index: 1;
        display: block;
        width: 0;
        height: 0;
        border-top: 32px solid transparent;
        border-bottom: 32px solid transparent;
        border-left: 16px solid transparent;
    }

    .breadcrumbs a:before {
        margin-left: 1px;
        border-left-color: #d5d5d5;
    }

    .breadcrumbs a:after {
        border-left-color: #f5f5f5;
    }

    .breadcrumbs a:hover:after {
        border-left-color: #eee;
    }

    .breadcrumbs a.active:after {
        border-left-color: #fafafa;
    }

    .breadcrumbs li:last-child a:before,
    .breadcrumbs li:last-child a:after {
        display: none;
    }

    @media (max-width: 720px) {
        .breadcrumbs a {
            padding: 15px;
        }

        .breadcrumbs a:before,
        .breadcrumbs a:after {
            border-top-width: 26px;
            border-bottom-width: 26px;
            border-left-width: 13px;
        }
    }

    @media (max-width: 620px) {
        .breadcrumbs a {
            padding: 10px;
            font-size: 12px;
        }

        .breadcrumbs a:before,
        .breadcrumbs a:after {
            border-top-width: 22px;
            border-bottom-width: 22px;
            border-left-width: 11px;
        }
    }

    @media (max-width: 520px) {
        .breadcrumbs a {
            padding: 5px;
        }

        .breadcrumbs a:before,
        .breadcrumbs a:after {
            border-top-width: 16px;
            border-bottom-width: 16px;
            border-left-width: 8px;
        }

        .breadcrumbs li a span:first-child {
            display: block;
            margin: 0 auto;
        }

        .breadcrumbs li a span:last-child {
            display: none;
        }
    }
</style>
<script>
    $("#licenseImage").fileinput({
        showUpload: false,
        showCaption: false,
        browseClass: "btn btn-primary",
        fileType: "any",
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
    });
    $("#transportImage").fileinput({
        showUpload: false,
        showCaption: false,
        browseClass: "btn btn-primary",
        fileType: "any",
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
    });
    $("#taxImage").fileinput({
        showUpload: false,
        showCaption: false,
        browseClass: "btn btn-primary",
        fileType: "any",
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
    });
    $("#codeImage").fileinput({
        showUpload: false,
        showCaption: false,
        browseClass: "btn btn-primary",
        fileType: "any",
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
    });
    $('#id').val(sessionStorage.getItem('session'));
    function reset() {
        $.post("resetAuth.php",
                function (data) {
                    if (data.result == 'success') {
                        $.get("authentication.html", function (data) {
                            $('#goodChildView').html(data)
                        })
                    }
                }, 'json'
        )
    }
    showLocation();
    $.post('authentication.php',
            {session: sessionStorage.getItem('session')},
            function (data) {
                var state = data.state;
                if (state == "wait") {
                    $('#s1').removeClass();
                    $('#s2').addClass('active');
                    $('#step1').hide();
                    $('#step2').show();
                    console.log('等待审核')
                } else if (state == 'authed') {
                    $('#company').html(data.name);
                    $('#person').html(data.person);
                    $('#phone').html(data.phone);
                    $('#addr').html(data.address);
                    $('#s1').removeClass();
                    $('#s3').addClass('active');
                    $('#step1').hide();
                    $('#step2').hide();
                    $('#step3').show();
                    $('#yes').show();
                    $('#no').hide();

                } else if (state == 'invalid') {
                    $('#reason').after(data.reason);
                    $('#s1').removeClass();
                    $('#s3').addClass('active');
                    $('#step1').hide();
                    $('#step2').hide();
                    $('#step3').show();
                    $('#yes').hide();
                    $('#no').show();
                }
            }, 'json');

    $('#defaultForm')
            .formValidation({
//                err: {
//                    container: 'tooltip'
//                },
                icon: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    name: {
                        validators: {
                            notEmpty: {
                                message: '公司名必填'
                            },
                        }
                    },
                    loc_town: {
                        validators: {
                            notEmpty: {
                                message: '地址必填'
                            }
                        }
                    },
                    detailAddress: {
                        validators: {
                            notEmpty: {
                                message: '详细地址必填'
                            }
                        }
                    },
                    phone: {
                        validators: {
                            notEmpty: {
                                message: '手机号码必填'
                            },
                            regexp: {
                                regexp: "^((13[0-9])|(15[^4,\\D])|(18[0,2,5-9]))\\d{8}$",
                                message: '不是正确的手机号码'
                            }
                        }
                    },
                    person: {
                        validators: {
                            notEmpty: {
                                message: '联系人名必填'
                            }
                        }
                    },
                    licenseID: {
                        validators: {
                            notEmpty: {
                                message: '营业执照注册号必填'
                            }
                        }
                    },
                    licenseImage: {
                        validators: {
                            file: {
                                extension: 'JPG,JPEG,png',
//                                                type: 'application/pdf',
                                maxSize: 1024 * 1024,
                                message: '请选择正确格式和大小的图片'
                            },
                            notEmpty: {
                                message: '必须上传图片'
                            },
                        }
                    },
                    transportImage: {
                        validators: {
                            file: {
                                extension: 'JPG,JPEG,png',
//                                                type: 'application/pdf',
                                maxSize: 1024 * 1024,
                                message: '请选择正确格式和大小的图片'
                            },
                            notEmpty: {
                                message: '必须上传图片'
                            },
                        }
                    },
                    taxImage: {
                        validators: {
                            file: {
                                extension: 'JPG,JPEG,png',
                                maxSize: 1024 * 1024,
                                message: '请选择正确格式和大小的图片'
                            },
                            notEmpty: {
                                message: '必须上传图片'
                            }
                        }
                    },
                    codeImage: {
                        validators: {
                            file: {
                                extension: 'JPG,JPEG,png',
                                maxSize: 1024 * 1024,
                                message: '请选择正确格式和大小的图片'
                            },
                            notEmpty: {
                                message: '必须上传图片'
                            },
                        }
                    }
                }
            })
            .on('success.form.fv', function (e) {
                e.preventDefault();
                var $form = $(e.target);

                // Get the FormValidation instance
                var bv = $form.data('formValidation');
                $('#address').val($('#loc_province  option:selected').text() + $('#loc_city  option:selected').text() + $('#loc_town  option:selected').text() + $('#detailAddress').val());
                $form.ajaxSubmit({
                    type: 'post',
                    dataType: 'json',
                    url: 'authCompany.php',
                    success: function (data) {
                        console.log(data);
                        if (data.result == 'success') {
                            Messenger().post("提交审核成功，等待客服人员审核")
                        }else {
                             Messenger().post({
                                 message:data.describe,
                                 type:'error'
                             })
                        }
                    }
                });
//                $.post("authCompany.php",
//                        $('#defaultForm').serialize(),
//                        function (data) {
//                            console.log(data);
//                            if (data.result == 'success') {
//                                $('#s1').removeClass();
//                                $('#s2').addClass('active');
//                                $('#step1').hide();
//                                $('#step2').show();
//                                Lobibox.notify('success', {
//                                    size: 'mini',
//                                    width: 300,
//                                    msg: '提交审核成功，等待客服人员审核'
//                                });
//                            }
//                            else {
//                                Lobibox.notify('error', {
//                                    size: 'mini',
//                                    width: 300,
//                                    msg: data.describe
//                                });
//                            }
//                        }, 'json'
//                )


            });


</script>
<div class="page-header">
    <ol class="breadcrumb">
        <li><a href="#">个人中心</a></li>
        <li class="active">会员认证</li>
    </ol>
</div>
<div class='breadcrumbs' style="margin-top: 30px">
    <div class='inners'>
        <ul class='cf'>
            <li><a id="s1" class='active'><span>1</span><span>认证</span></a></li>
            <li><a id="s2"><span>2</span><span>审核中</span></a></li>
            <li><a id="s3"><span>3</span><span>审核完成</span></a></li>
        </ul>
    </div>
</div>
<div id="step1" style="margin-top: 20px;display: block">
    <form id="defaultForm" method="post" class="form-horizontal">
        <input type="text" id="id" name="session" style="display: none">
        <div class="form-group">
            <label class="col-lg-3 control-label">公司名</label>
            <div class="col-lg-5">
                <input type="text" class="form-control" name="name" />
            </div>
        </div>

        <div class="form-group">

            <label class="col-lg-3 control-label">地址</label>


            <div class="col-lg-5">
                <select style="width: 30%;float: left;margin-right: 10px;" id="loc_province"
                        class="form-control"></select>
                <select style="width: 30%;float: left;margin-right: 10px;" id="loc_city"
                        class="form-control"></select>
                <select name="loc_town" style="width: 30%;" id="loc_town" class="form-control"></select>
            </div>
        </div>

        <div class="form-group">
            <label class="col-lg-3 control-label">详细地址</label>

            <div class="col-lg-5">
                <input type="text" class="form-control" name="detailAddress" id="detailAddress"
                       placeholder="请填写公司的详细地址"/>
            </div>
        </div>
        <input type="text" name="address" id="address"
               style="display:none;">

        <div class="form-group">
            <label class="col-lg-3 control-label">联系人</label>

            <div class="col-lg-5">
                <input type="text" class="form-control" name="person" placeholder="请输入联系人"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-3 control-label">手机号码</label>

            <div class="col-lg-5">
                <input type="text" class="form-control" name="phone" placeholder="请输入手机号码"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-3 control-label">营业执照注册号</label>

            <div class="col-lg-5">
                <input type="text" class="form-control" name="licenseID" placeholder="营业执照注册号码"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-3 control-label">营业执照图片</label>

            <div class="col-lg-5">
                <input id="licenseImage" name="licenseImage" type="file">

            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-3 control-label">行驶证</label>

            <div class="col-lg-5">
                <input id="transportImage" name="transportImage" type="file">

            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-3 control-label">税务登记证</label>

            <div class="col-lg-5">
                <input id="taxImage" name="taxImage" type="file">

            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-3 control-label">组织机构代码证</label>

            <div class="col-lg-5">
                <input id="codeImage" name="codeImage" type="file">

            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-8 col-sm-offset-4">
                <button type="submit" class="btn btn-primary">提交审核</button>
            </div>
        </div>
    </form>
</div>
<div id="step2" style="width: 100%;margin-top: 20px;display: none;">
    <div class="col-md-2"></div>
    <div class="col-md-8">
        <div class="alert alert-success" role="alert" style="height: 200px">
            <strong>Success!</strong>
            <hr>
            <p>你提交的企业信息已转交至后台，我们工作人员会在3-5内审核完成。您可以继续浏览货源货源或者车源</p>
        </div>
    </div>
    <div class="col-md-2"></div>

</div>
<div id="step3" style="width: 100%;margin-top: 20px;display: none;">
    <div id="yes" class="alert alert-success" role="alert">
        <strong>你已通过认证</strong>
        <hr>
        <table class="table table-striped">
            <tr>
                <td>公司名</td>
                <td id="company"></td>
            </tr>
            <tr>
                <td>联系人</td>
                <td id="person"></td>
            </tr>
            <tr>
                <td>联系电话</td>
                <td id="phone"></td>
            </tr>
            <tr>
                <td>地址</td>
                <td id="addr"></td>
            </tr>
        </table>
    </div>
    <div id="no" class="alert alert-warning" role="alert">
        <strong>认证失败</strong>
        <hr id="reason">
        请<a href="javascript:void(0)" style="color: red" onclick="reset()">重新认证</a>
    </div>
    </if>
</div>
